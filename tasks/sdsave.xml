<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" ?>
<casaxml xmlns="http://casa.nrao.edu/schema/psetTypes.html"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://casa.nrao.edu/schema/casa.xsd
file:///opt/casa/code/xmlcasa/xml/casa.xsd">


<!-- This is the param set for sdsave -->

<task type="function" name="sdsave" startup="false" category="single dish">

  <shortdescription>ASAP SD task: save the sd spectra in various format</shortdescription>

  <description>
        ASAP SD task (based on the ALMATST5 recommendations):
        save the sd spectra in various format

        Task Version 2008-01-29 TT
</description>

  <input>

    <param type="string" name="infile"  mustexist="true">
    <description>name of input SD dataset</description>
    <value></value>
    </param>

    <param type="bool" name="splitant">
            <description>split output file by antenna (True,False) (only effective for MS input and ASAP output)</description>
            <value>False</value>
    </param>

    <param type="any" name="antenna" subparam="true">
            <description>antenna name or id (only effective for MS input)</description>
            <any type="variant" limittype="string int"/>
            <value type="int">0</value>
    </param> 

    <param type="bool" name="getpt">
            <description>fill DIRECTION column properly, or reuse POINTING table in original MS (only effective for MS input)</description>
            <value>True</value>
    </param>

    <param type="intArray" name="rowlist">
	    <description>list of row numbers to process (e.g. [0,2,4,6])</description>
	    <value></value>
    </param>

    <param type="intArray" name="scanlist">
	    <description>list of scan to process (e.g. [20,21,22,23])</description>
	    <value></value>
    </param>

    <param type="string" name="field">
            <description>string for selection by source name</description>
            <value></value>
    </param>

    <param type="intArray" name="iflist">
            <description>list of IF ids to select (e.g. [0,1])</description>
            <value></value>
    </param>

    <param type="intArray" name="pollist">
            <description>list of polarization ids to select (e.g. [0,1])</description>
            <value></value>
    </param>

    <param type="bool" name="scanaverage">
            <description>average integs within scans (True,False) </description>
            <value>False</value>
    </param>

    <param type="bool" name="timeaverage">
            <description>average scans over time (True,False)</description>
            <value>False</value>
    </param>

    <param type="string" name="tweight" subparam="true">
            <description>weighting for time averaging</description>
            <value>none</value>
            <allowed kind="enum">
            <value>none</value>
            <value>var</value>
            <value>tsys</value>
            <value>tint</value>
            <value>tintsys</value>
            <value>median</value>
            </allowed>
    </param>

    <param type="bool" name="polaverage">
            <description>average over polarizations (True,False)</description>
            <value>False</value>
    </param>

    <param type="string" name="pweight" subparam="true">
            <value>none</value>
            <allowed kind="enum">
            <value>none</value>
            <value>var</value>
            <value>tsys</value>
            </allowed>
    </param>

    <param type="any" name="restfreq">
            <description>rest frequency (default unit: Hz)</description>
            <any type="variant" limittype="string double int string doubleArray intArray stringArray dictArray"/>
            <value type="string"/>
    </param>

    <param type="string" name="outfile">
	    <description>output file name</description>
	    <value></value>
    </param>

    <param type="string" name="outform">
	    <description>output file format (ASCII,MS2,SDFITS,ASAP)</description>
	    <value>ASAP</value>
	    <allowed kind="enum">
	    <value>ASCII</value>
	    <value>MS2</value>
	    <value>SDFITS</value>
	    <value>ASAP</value>
	    </allowed>
    </param>

    <param type="bool" name="overwrite">
	    <description>overwrite the output file if already exists</description>
	    <value>False</value>
    </param>

    <constraints>
            <when param="splitant">                
                 <equals type="bool" value="False">
                        <default param="antenna"><value type='any'>0</value></default>
                 </equals>
                 <equals type="bool" value="True"/>
            </when>
            <when param="timeaverage">                
                 <equals type="bool" value="False"/>
                 <equals type="bool" value="True">
                        <default param="tweight"><value type='string'>none</value></default>
                 </equals>
            </when>
            <when param="polaverage">
                 <equals type="bool" value="False"/>
                 <equals type="bool" value="True">
                        <default param="pweight"><value type='string'>none</value></default>
                 </equals>
            </when>
    </constraints>

    </input>

  <returns type="void"/>

  <example>
  Keyword arguments:
        infile -- name of input SD dataset
        splitant -- split output file by antenna (True,False) 
                (only effective for MS input and ASAP output).
                default: False
                &gt;&gt;&gt;splitant expandable parameter
                 antenna -- antenna name or id (only effective for MS input). 
                         default: 0
        getpt -- fill DIRECTION column properly, or reuse POINTING table 
                in original MS (only effective for MS input)
                default: True
                options: True (fill DIRECTION column properly)
                         False (reuse POINTING table in original MS)
        rowlist -- list of row numbers to process
                default: [] (use all rows)
                example: [0,2,4,6]
                For expert users only!
                this selection is applied first, and then followed by
                the selection with scans, fields, ifs, and polarizations. 
        scanlist -- list of to process
                default: [] (use all scans)
                example: [21,22,23,24]
                this selection is in addition to field, iflist, and pollist
        field -- selection string for selecting scans by name
                default: '' (no name selection)
                example: 'FLS3a*'
                this selection is in addition to scanlist, iflist, and pollist
        iflist -- list of IF id numbers to select
                default: [] (use all IFs)
                example: [15]
                this selection is in addition to scanlist, field, and pollist
        pollist -- list of polarization id numbers to select
                default: [] (use all polarizations)
                example: [1]
                this selection is in addition to scanlist, field, and iflist
        scanaverage --  average integrations within scans
                options: (bool) True,False
                default: False
                example: if True, average integrations before it is saved
        timeaverage -- average times for multiple scan cycles
                options: (bool) True,False
                default: False
                &gt;&gt;&gt;timeaverage expandable parameter
                 tweight -- weighting for time average
                         options: 'none'
                                  'var'   (1/var(spec) weighted)
                                  'tsys'  (1/Tsys**2 weighted)
                                  'tint'  (integration time weighted)
                                  'tintsys'  (Tint/Tsys**2)
                                  'median'  ( median averaging)
                         default: 'none'

        polaverage -- average polarizations
                options: (bool) True,False
                default: False
                &gt;&gt;&gt;polaverage expandable parameter
                 pweight -- weighting for polarization average
                         options: 'none'
                                  'var'  (1/var(spec) weighted)
                                  'tsys' (1/Tsys**2 weighted)
        restfreq -- rest frequencies of output data
                Available types are a number, string, a list of numbers or
                strings (see examples below), and list of dictionaries. 
                The default unit of restfreq is Hz, if not specified.
                A list can be used to set different rest frequencies to
                each IF. the length of list input must be nIF. Dictionary 
                input should be a pair of molecule name and frequency with 
                keys of 'name' and 'value', respectively. The 'value's in the 
                dictionary input follows the same manner as for single 
                float or string input. 
                default: '' (use current setting)
                example: 4.6e10 (float value in Hz),
                         '46GHz' (string with unit),
                         ['345.8GHz', '347.0GHz', 356.7e9] (for each IF)
                         [{'name':'CO','value':345e9}] (a value with name)
        outfile -- name of output dataset
                default: '' 
        outform -- output data format
                default: 'ASAP'
                Options: 'ASAP', 'MS2', 'SDFITS', 'ASCII'
        overwrite -- overwrite the output file if already exists
                options: (bool) True,False
                default: False
                WARNING: if outform='ASCII', this parameter is ignored


        DESCRIPTION:

        Task sdsave writes the single dish data to a disk file in 
        specified format (ASAP, MS2, SDFITS, ASCII). It is possible to 
        save the subset of the data by selecting row numbers, scan numbers, 
        IF ids, polarization ids and field names. The ASAP (scantable) format 
        is recommended for further analysis using Sd tool. For further 
        imaging using imager, save the data to the Measurement Set (MS2).

        Note that setting getpt=False needs a lot of attention.
        If you set getpt=False, the task retrieves pointing direction from 
        MS's FIELD table, which might not be correct for single dish 
        observation, instead to check MS's POINTING table, which is the 
        default behavior of the task (getpt=True). To compensate this, 
        absolute path to MS's POINTING table is stored, and it will be used 
        for POINTING table when the data is converted back to MS format. 
        In general, getpt=False is faster especially for large data. However, 
        MS created from Scantable cannot have correct POINTING table if 
        original MS's POINTING table doesn't exist. Such situation will 
        happen when original MS is removed or renamed, or imported Scantable 
        is moved to other computer alone.

        WARNING for the GBT raw SDFITS format data as input:
        SDtasks are able to handle GBT raw SDFITS format data since the 
        data filler is available. However, the functionality is not well 
        tested yet, so that there may be unknown bugs.  

  </example>

</task>

</casaxml>
